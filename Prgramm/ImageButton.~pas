unit ImageButton;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  ExtCtrls, axctrls;

type
  TImageButton = class(TImage)
  private
    { Private-Deklarationen }
    FThemenfarbe1:TColor;
    FThemenfarbe2:TColor;
  protected
    { Protected-Deklarationen }
    procedure MouseMove(Shift: TShiftState; X,
      Y: Integer); override;
    function Pixelfarbe(const x,y: integer): TColor;
  public
    { Public-Deklarationen }
    constructor Create(AOwner:TComponent);override;
    procedure BildLaden(Datei: string);
    procedure pause(zeit:longint);
  published
    { Published-Deklarationen }
    property OnMouseMove;
    property Stretch default true;
    property Themenfarbe1:Tcolor read FThemenfarbe1 write FThemenfarbe1 default clWhite;
    property Themenfarbe2:Tcolor read FThemenfarbe2 write FThemenfarbe2 default clWhite;
  end;


procedure Register;

implementation

procedure TImageButton.pause(zeit:longint);
var zeit1 : longint;
begin
     zeit1 := GetTickCount;
     repeat
           Application.ProcessMessages;
     until (GetTickCount - zeit1 > zeit);
end;


constructor TImageButton.Create(AOwner:TComponent);
begin
     inherited Create(AOwner);
     Stretch := true;
end;

procedure TImageButton.BildLaden(Datei: string);
var
  FStream: TFileStream;
  OLEBild: TOleGraphic;
begin
  OLEBild := TOleGraphic.Create;
  FStream := TFileStream.Create(Datei, fmOpenRead or fmShareDenyNone);
  try
    OLEBild.LoadFromStream(FStream);
    Picture.Assign(OLEBild);
  finally
    FStream.Free;
    OLEBild.free;
  end;
end;


procedure TImageButton.MouseMove(Shift:TShiftState;X,Y:integer);
var i,k,l: integer;
begin
     inherited MouseMove(Shift,X,Y);

     k := round(3*((Screen.Height / 3)+1)/ 4);
     l := round(4*((Screen.Height / 3))/ 5);
     if Pixelfarbe(X+Left,Y+Top) <> Themenfarbe1 then
     begin
          if Height < l then
          begin
               repeat;
                    Left  := Left - 1;
                    Top   := Top  - 1;
                    Width := Width +2;
                    Height:= Height+2;
                    pause(1);
               until Height = l;
          end;
     end;
     if Pixelfarbe(X+Left,Y+Top) = Themenfarbe1 then
     begin
          if Height > k then
          begin
               repeat;
                    Left  := Left + 1;
                    Top   := Top  + 1;
                    Width := Width -2;
                    Height:= Height-2;
                    pause(1);
               until Height = k;
          end;
     end;
end;

function TImageButton.Pixelfarbe(const x,y: integer): TColor;
var
   c:TCanvas;
begin
   c:=TCanvas.create;
   c.handle:= GetWindowDC(GetDesktopWindow);
   result:=getpixel(c.handle,x,y);
   c.free;
end;


procedure Register;
begin
  RegisterComponents('Übung', [TImageButton]);
end;

end.
